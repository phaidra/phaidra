<IfDefine ACME>
  LoadModule watchdog_module modules/mod_watchdog.so
  LoadModule md_module modules/mod_md.so
  LoadModule http2_module modules/mod_http2.so

  <IfModule ssl_module>
    SSLEngine on
    MDStoreDir /mnt/mdcerts
    <MDomain ${PHAIDRA_HOSTNAME}>
      MDCertificateAuthority ${CA_ENDPOINT}
      Protocols h2 http/1.1 acme-tls/1
      ServerAdmin ${PHAIDRA_ADMIN_EMAIL}
      MDCertificateAgreement ${MD_CERTIFICATE_AGREEMENT}
    </MDomain>
  </IfModule>
</IfDefine>

<IfDefine !ACME>
  <IfModule ssl_module>
    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/server.key"
  </IfModule>
</IfDefine>

<IfDefine PFSA>
  ProxyPass /pfsa !
  Alias "/pfsa" "/mnt/pfsa"
  <Directory "/mnt/pfsa">
    SetOutputFilter RATE_LIMIT
    SetEnv rate-limit 512
    SetEnv rate-initial-burst 1024
    Options Indexes
    AllowOverride None
    Require all granted
  </Directory>
</IfDefine>

<IfDefine PFSA_REDIRECT>
  ProxyPass /pfsa !
  RedirectMatch 302 ^/pfsa(/.*)?$ https://${HTTPD_PFSA_REDIRECT_FQDN}/pfsa$1
</IfDefine>

<IfDefine NOINDEX>
  Header always set X-Robots-Tag "noindex, nofollow"
</IfDefine>